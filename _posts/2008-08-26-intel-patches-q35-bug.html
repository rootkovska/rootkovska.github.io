---
layout: post
title: Intel patches the Q35 bug
date: '2008-08-26T09:41:00.001+02:00'
author: Joanna Rutkowska
tags: 
modified_time: '2009-03-25T16:03:19.027+01:00'
blogger_id: tag:blogger.com,1999:blog-24586388.post-2529149620297733085
blogger_orig_url: http://theinvisiblethings.blogspot.com/2008/08/intel-patches-q35-bug.html
---

Yesterday Intel has published an <a href="http://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00017&languageid=en-fr">official advisory</a> that addresses the Q35 bug and attack, that we used during Black Hat as one of the ways to subvert Xen 3.3 on a VT-d enabled system (the alternative way was to use the Xen-specific FLASK exploit, that worked even from an unprivileged domain).<br /><br />One small clarification though: in the advisory they stated that: "Software running administrative (ring 0) privilege can under certain circumstances change code running in System Management Mode." But in fact an attacker might also use this bug to directly modify the hypervisor memory, without jumping into the SMM first, just as we did it with our exploit. Also, in case of e.g. Linux systems, the Ring0 access is not strictly required to perform the attack, as it's just enough for the attacker to get access to the PCI config space of the device 0:0:0, which e.g. on Linux can be granted to usermode applications via the iopl() system call.<br /><br />You can download a new firmware for your motherboard from <a href="http://downloadcenter.intel.com/Filter_Results.aspx?strTypes=all&ProductID=2783&OSFullName=OS+Independent&lang=eng&strOSs=38&submit=Go!">here</a>.<br /><br />Intel did a good job on handling this bug - not only they recognized the importance of the attack, but also released the patch promptly. Quite positively surprising as for such a big company.<br /><br />So, now we're free to publish all the missing slides about how we exploit this vulnerability that we had to remove from our Black Hat presentation, as well as the exploit code. However, as I'm going to give 2 presentations at the upcoming <a href="http://isf.no/index_net.htm">ISF conference</a> in Sweden early next week, I thought it would be logical to wait with disclosing this material and present it at this conference, during my technical speech (I will also deliver the keynote for this conference). Of course, as soon as I will get back home (Thursday next week), we will publish the full slides, exploit codes and all the demos, as promised earlier.<br /><br />Speaking of speaking: also next month, Rafal will fly to Oregon, to Intel campus, for the Intel Virtualization Security Summit, where he will deliver a "compressed" version of our Xen 0wning Trilogy to the technical crowd of Intel employees. Rafal will provide some more details about the HyperGuard project that we do in cooperation with Phoenix Technologies. Also, in October, Alex will visit Kuala Lumpur and present an updated Bluepilling the Xen Hypervisor talk at the Hack In The Box conference.