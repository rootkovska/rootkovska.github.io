---
layout: post
title: Attacking SMM Memory via Intel® CPU Cache Poisoning
date: '2009-03-19T17:02:00.001+01:00'
author: Joanna Rutkowska
tags:
- attack
- smm
- exploit
modified_time: '2009-03-25T15:08:59.440+01:00'
blogger_id: tag:blogger.com,1999:blog-24586388.post-7397577755549629314
blogger_orig_url: http://theinvisiblethings.blogspot.com/2009/03/attacking-smm-memory-via-intel-cpu.html
---

As <a href="/2009/03/13/independent-attack-discoveries.html">promised</a>, the paper and the proof of concept code has just been posted on the ITL website <a href="http://invisiblethingslab.com/itl/Resources.html">here</a>.<br /><br />A quote from the paper:<br /><blockquote>In this paper we have described practical exploitation of the CPU cache poisoning in order to read or write into (otherwise protected) SMRAM memory. We have implemented two working exploits: one for dumping the content of SMRAM and the other one for arbitrary code execution in SMRAM. This is the third attack on SMM memory our team has found within the last 10 months, affecting Intel-based systems. It seems that current state of firmware security, even in case of such reputable vendors as Intel, is quite unsatisfying.<br /><br />The potential consequence of attacks on SMM might include SMM rootkits [9], hypervisor compromises [8], or OS kernel protection bypassing [2].<br /></blockquote>Don't worry, the shellcode we use in the exploit is totally harmless (have really no idea how some people concluded we were going to release an SMM rootkit today?) — it only increases an internal counter on every SMI and jumps back to the original handler. If you want something more fancy, AKA SMM rootkits, you might want to re-read Sherri's and Shawn's last year's <a href="http://www.eecs.ucf.edu/%7Eczou/research/SMM-Rootkits-Securecom08.pdf">Black Hat paper</a> and try writing something they describe there.<br /><br />The attack presented in the paper has been fixed on some systems according to Intel. We have however found out that even the relatively new boards, like e.g. <a href="http://www.intel.com/products/desktop/motherboards/DQ35JO/DQ35JO-overview.htm">Intel DQ35</a> are still vulnerable (the very recent <a href="http://www.intel.com/products/desktop/motherboards/DQ45CB/DQ45CB-overview.htm">Intel DQ45</a> doesn't seem to be vulnerable though). The exploit attached is for DQ35 board — the offsets would have to be changed to work on other boards (please do not ask how to do this).<br /><br />Keep in mind this is a different SMM attack than the one we mentioned during our last month's Black Hat presentation on <a href="http://invisiblethingslab.com/resources/bh09dc/Attacking%20Intel%20TXT%20-%20slides.pdf">TXT bypassing</a> (the VU#127284). We are planning to present that other attack at the upcoming Black Hat Vegas. Hopefully this will not be the only one thing that ITL will entertain you with in Vegas —  Alex and Rafal are already working now on something even cooler (and even lower level) for the show, so cross your fingers!<br /><br />And good luck to Loic with <a href="http://cansecwest.com/agenda.html">his presentation</a> that is about to start just now...