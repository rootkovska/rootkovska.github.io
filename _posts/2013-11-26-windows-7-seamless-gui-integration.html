---
layout: post
title: Windows 7 seamless GUI integration coming to Qubes OS!
date: '2013-11-26T18:04:00.001+01:00'
author: Joanna Rutkowska
tags: 
modified_time: '2014-11-27T13:25:04.398+01:00'
thumbnail: http://1.bp.blogspot.com/-PJN1_VDD1NQ/UpTN4lE_xdI/AAAAAAAAAME/KmnnAnNmMGo/s72-c/windows-seamless-1.png
blogger_id: tag:blogger.com,1999:blog-24586388.post-3852916224574976224
blogger_orig_url: http://theinvisiblethings.blogspot.com/2013/11/windows-7-seamless-gui-integration.html
---

<style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  <br /><div style="margin-bottom: 0in;">Finally, after months of hard work, seamless mode for Windows 7 AppVMs is coming to Qubes OS! The new Windows Support Tools will be released together with the Qubes OS R2 Beta 3, which we plan to release in the next 1-2 weeks. Here is an obligatory screenshot showing a few Windows apps running in seamless mode integrated onto Qubes trusted desktop (note the usual Qubes trusted decorations around each of the Win7 windows):</div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-PJN1_VDD1NQ/UpTN4lE_xdI/AAAAAAAAAME/KmnnAnNmMGo/s1600/windows-seamless-1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-PJN1_VDD1NQ/UpTN4lE_xdI/AAAAAAAAAME/KmnnAnNmMGo/s400/windows-seamless-1.png" height="225" width="400" /></a></div><br /><style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  <br /><div style="margin-bottom: 0in;"><span style="font-style: normal;">The seamless mode for Windows AppVMs is not </span><span style="font-style: normal;">yet </span><span style="font-style: normal;">as </span><span style="font-style: normal;">polished</span><span style="font-style: normal;">as the one we have for Linux AppVMs, </span><span style="font-style: normal;">because, unlike what we do for Xorg, the Windows GUI agent is not based on composition buffers extraction. </span><span style="font-style: normal;">This causes some, </span><span style="font-style: normal;">rather</span><span style="font-style: normal;">minor</span><span style="font-style: normal;">, </span><span style="font-style: normal;">cosmetic problems. For example, when we have two overlapping windows from a Win7 AppVM, and move the top window away, its remaining "shadow" will be visible on the underlying window for the duration of the operation. But generally this all works reasonably good, and </span><span style="font-style: normal;">you should not </span><span style="font-style: normal;">really </span><span style="font-style: normal;">feel any slowness </span><span style="font-style: normal;">or heaviness </span><span style="font-style: normal;">compared to Linux AppVMs </span><span style="font-style: normal;">virtualization. It should be noted that we managed to add this seamless support for Windows AppVMs without any changes to our secure GUI virtualization protocol. </span></div><div style="margin-bottom: 0in;"><br /><span style="font-style: normal;">Of course, </span><span style="font-style: normal;">the usual </span><span style="font-style: normal;">Qubes integration features, such as secure inter-VM clipboard and file copy also work for Windows AppVMs </span><span style="font-style: normal;">with the tools installed</span><span style="font-style: normal;">. </span></div><div style="font-style: normal; margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;"><span style="font-style: normal;">The </span><span style="font-style: normal;">Qubes </span><span style="font-style: normal;">Windows </span><span style="font-style: normal;">S</span><span style="font-style: normal;">upport </span><span style="font-style: normal;">T</span><span style="font-style: normal;">ools </span><span style="font-style: normal;">are proprietary, but they are </span><span style="font-style: normal;">supposed to be installed </span><span style="font-style: normal;">only in the Windows 7 VMs, which themselves contain millions of lines of proprietary code </span><span style="font-style: normal;">already.</span><span style="font-style: normal;"> B</span><span style="font-style: normal;">esides that, the tools </span><span style="font-style: normal;">do not introduce any other modifications to </span><span style="font-style: normal;">the system</span><span style="font-style: normal;">.</span></div><div style="font-style: normal; margin-bottom: 0in;"><br /></div><div style="font-style: normal; margin-bottom: 0in;">As a special bonus we have also added (and releasing also in R2B3) the support for template-based HVMs. So it will now be possible to do something like this:</div><br /><style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  <br /><div style="margin-bottom: 0in;"><span style="font-family: DejaVu Sans Mono, monospace; font-size: x-small;"><span style="font-style: normal;">qvm-create </span><span style="font-style: normal;">--</span><span style="font-style: normal;">hvm work-win7 </span><b><span style="font-style: normal;">--</span></b><span style="font-style: normal;"><b>template win7-x64</b> </span><span style="font-style: normal;">--</span><span style="font-style: normal;">label green</span></span></div><span style="font-family: DejaVu Sans Mono, monospace; font-size: x-small;"><span style="font-style: normal;">qvm-create </span><span style="font-style: normal;">--</span><span style="font-style: normal;">hvm personal-win7 </span><b><span style="font-style: normal;">--</span></b><span style="font-style: normal;"><b>template win7-x64</b> </span><span style="font-style: normal;">--</span><span style="font-style: normal;">label purple</span></span><br /><span style="font-family: DejaVu Sans Mono, monospace; font-size: x-small;"><span style="font-style: normal;">qvm-create</span><span style="font-style: normal;">--</span><span style="font-style: normal;">hvm testing-win7 </span><b><span style="font-style: normal;">--</span></b><span style="font-style: normal;"><b>template win7-x64</b> </span><span style="font-style: normal;">--</span><span style="font-style: normal;">label red</span></span><br /><span style="font-size: x-small;"></span><br /><div style="font-style: normal; margin-bottom: 0in;"><span style="font-size: x-small;"><br /></span></div><span style="font-size: x-small;"> </span>         <style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style><span style="font-style: normal;">... telling</span><span style="font-style: normal;"></span><span style="font-style: normal;">Qubes to </span><span style="font-style: normal;">create</span><span style="font-style: normal;"></span><span style="font-style: normal;">three</span><span style="font-style: normal;"> HVM </span><span style="font-style: normal;">AppVMs based on </span><span style="font-style: normal;">th</span><span style="font-style: normal;">e same </span><span style="font-style: normal;">template</span><span style="font-style: normal;">.</span><br /><div style="font-style: normal; margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;"><span style="font-style: normal;">All such template-based</span><span style="font-style: normal;"> </span><span style="font-style: normal;">AppVMs </span><span style="font-style: normal;">use the root filesystem from the Template VM, which is shared in a read-only manner, of course, but Qubes makes it look for the AppVMs as if the root filesystem was </span><span style="font-style: normal;">writable.</span><span style="font-style: normal;">Just like in case of </span><span style="font-style: normal;">Linux AppVMs, the actual writes are stored in COW buffer</span><span style="font-style: normal;">s</span><span style="font-style: normal;">backed by files stored in each of the AppVMs directories. Upon AppVM's reboot, tho</span><span style="font-style: normal;">se</span><span style="font-style: normal;">file</span><span style="font-style: normal;">s</span><span style="font-style: normal;"></span><span style="font-style: normal;">are</span><span style="font-style: normal;">discarded, which reverts the VMs' root filesystems back to that of the template (the “golden image”). </span></div><div style="font-style: normal; margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;"><span style="font-style: normal;">For the above mechanism to make </span><span style="font-style: normal;">any </span><span style="font-style: normal;">sense we should configure the </span><span style="font-style: normal;">OS in the </span><span style="font-style: normal;">Template VM</span><span style="font-style: normal;">to </span><span style="font-style: normal;">use</span><span style="font-style: normal;">a separate disk for the user's home director</span><span style="font-style: normal;">y(ies</span><span style="font-style: normal;">) (</span><span style="font-style: normal;">e.g. </span><span style="font-style: normal;">C:\Users in case of Windows). </span><span style="font-style: normal;">Qubes automatically exposes an</span><span style="font-style: normal;"> additional private disk to each of the AppVMs exactly for this very purpose. Again, just like it has been done for Linux AppVMs for years.</span></div><div style="font-style: normal; margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;"><span style="font-style: normal;">The above feature allows to create lots of Windows AppVMs quickly and with minimal use of disk space, </span><span style="font-style: normal;">and with an ability to centrally </span><span style="font-style: normal;"></span><span style="font-style: normal;">update all the system software in all the AppVMs all at once. </span><span style="font-style: normal;">Just like for Linux AppVMs.</span></div><div style="margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;"><span style="font-style: normal;">Users should, however, ensure that the</span><span style="font-style: normal;">i</span><span style="font-style: normal;">r license allows for such instantiating of the OS they use in the template. </span><span style="font-style: normal;">Note that from the technical point of view the OS is installed, and, in case of Windows, also </span><span style="font-style: normal;"><span style="font-style: normal;">activated</span>, only once: in the template VM. The installed files are never copied, they are only </span><i>shared</i><span style="font-style: normal;"> with the running instances of AppVMs. Consult your software licensing lawyer.</span></div>