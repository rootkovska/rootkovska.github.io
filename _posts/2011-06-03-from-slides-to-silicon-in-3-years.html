---
layout: post
title: From Slides to Silicon in 3 years!
date: '2011-06-03T17:16:00.003+02:00'
author: Joanna Rutkowska
tags:
- general
- fighting for a better world
modified_time: '2011-07-24T12:08:54.874+02:00'
thumbnail: http://2.bp.blogspot.com/-UUqClGOWD3w/Tej5DuLF_GI/AAAAAAAAAIE/qBrKYYHJi8M/s72-c/slide97
blogger_id: tag:blogger.com,1999:blog-24586388.post-3206816702689101078
blogger_orig_url: http://theinvisiblethings.blogspot.com/2011/06/from-slides-to-silicon-in-3-years.html
---

<style type="text/css">p { margin-bottom: 0.08in; }a:link {  } </style>  <br /><div style="margin-bottom: 0in;">Remember our Xen 0wning Trilogy at Black Hat in summer 2008, specifically the presentation on <a href="http://invisiblethingslab.com/resources/bh08/part2-full.pdf"><i>Detecting &amp; Preventing the Xen Hypervisor Subversions</i></a><span style="font-style: normal;">?</span></div><div style="margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;"><style type="text/css">p { margin-bottom: 0.08in; }a:link {  } </style>  </div><div style="margin-bottom: 0in;"><span style="font-style: normal;">One of the things <a href="http://www.blogger.com/goog_852802259"></a><a href="http://theinvisiblethings.blogspot.com/2008/08/our-xen-0wning-trilogy-highlights.html">we were discussing</a> there was a proposal to include an additional restriction to Intel processors that would disallow execution of </span><i>usermode</i><span style="font-style: normal;"> pages from within </span><i>supervisor</i><span style="font-style: normal;"> mode (ring0). Such a feature, we argued, apart from obviously making many ring3-to-ring0 exploits much harder, including the very Xen heap overflow exploit we presented in the slides, would also bring us closer to efficient runtime code integrity checkers for kernels and hypervisors, as discussed in the slides.</span></div><div style="margin-bottom: 0in;"><br /></div><span style="font-style: normal;"></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-UUqClGOWD3w/Tej5DuLF_GI/AAAAAAAAAIE/qBrKYYHJi8M/s1600/slide97" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="156" src="http://2.bp.blogspot.com/-UUqClGOWD3w/Tej5DuLF_GI/AAAAAAAAAIE/qBrKYYHJi8M/s400/slide97" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Slide #97, Detecting and Preventing Xen Hypervisor Subversions, Black Hat USA, July, 2008</td></tr></tbody></table><style type="text/css">p { margin-bottom: 0.08in; } </style>  <br /><div style="margin-bottom: 0in;"><span style="font-style: normal;">Fast forward 3 years. On June 1</span><sup><span style="font-style: normal;">st</span></sup><span style="font-style: normal;">, 2011, an Intel engineer is submitting a patch for Xen to support a mysterious new processor feature called SMEP (Supervisor Mode Execution Protection). He writes the feature is not yet documented in SDM, but soon will be. In fact, the May 2011 update of Intel SDM already contains the details:</span><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-OQB3mPqycFY/Tej7twiRhPI/AAAAAAAAAIc/nIv8J26rsL4/s1600/sdm-smep" style="margin-left: auto; margin-right: auto;"><img border="0" height="48" src="http://3.bp.blogspot.com/-OQB3mPqycFY/Tej7twiRhPI/AAAAAAAAAIc/nIv8J26rsL4/s400/sdm-smep" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Intel SDM, vol. 3a, May 2011, source: intel.com</td></tr></tbody></table></div><div class="separator" style="clear: both; text-align: center;"></div><style type="text/css">p { margin-bottom: 0.08in; }a:link {  } </style>  <br /><div style="margin-bottom: 0in;"><span style="font-style: normal;">Some other people spotted this feature earlier, because of <a href="http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=de5397ad5b9ad22e2401c4dacdf1bb3b19c05679">another patch</a> submitted by another Intel engineer to Linux kernel a few weeks ago. Here's a <a href="http://vulnfactory.org/blog/smep/">good write up by Dan Rosenberg</a> discussing how this patch makes writing Linux kernel exploits harder, and how it's still possible to write them.</span></div><div style="font-style: normal; margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;">The SMEP feature still doesn't seem to be present in the processors available on the market, including the latest Sand Bridge processors, but there's no question it's coming, now that the feature made it into SDM.</div><div style="margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;">It is quite rewarding to see your idea implemented in a <i>processor</i>... I guess this is how physicists feel when they introduce a new particle as part of a new quantum model, and later discover evidences to support the existence of this very particle in the wild...</div>