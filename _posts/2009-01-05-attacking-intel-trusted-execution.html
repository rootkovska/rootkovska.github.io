---
layout: post
title: Attacking Intel® Trusted Execution Technology
date: '2009-01-05T16:30:00.005+01:00'
author: Joanna Rutkowska
tags:
- attack
- trusted execution technology
- trusted computing
- exploit
modified_time: '2009-03-19T22:20:19.253+01:00'
thumbnail: http://1.bp.blogspot.com/_Ti3q3Hdvels/SWI4MzG1jdI/AAAAAAAAADU/xaj6gqT72bQ/s72-c/processor+padlock.jpg
blogger_id: tag:blogger.com,1999:blog-24586388.post-1619925805743086461
blogger_orig_url: http://theinvisiblethings.blogspot.com/2009/01/attacking-intel-trusted-execution.html
---

<a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_Ti3q3Hdvels/SWI4MzG1jdI/AAAAAAAAADU/xaj6gqT72bQ/s1600-h/processor+padlock.jpg"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer; width: 320px; height: 213px;" src="http://1.bp.blogspot.com/_Ti3q3Hdvels/SWI4MzG1jdI/AAAAAAAAADU/xaj6gqT72bQ/s320/processor+padlock.jpg" alt="" id="BLOGGER_PHOTO_ID_5287850705014853074" border="0" /></a><br /><br />Press people: please read <a href="http://invisiblethingslab.com/press/itl-press-2009-01.pdf">our press release</a> first and also refer to the disclaimer at the end of this blog post. Thank you!<br /><br /><span style="font-size:85%;">Update: 1/5/2009 19:21 CEST: minor typos/spelling corrections. Thanks to Jarred for point out some of the typos.</span><br /><br /><span style="font-weight: bold;">A word about Trusted Computing</span><br />The term Trusted Computing and related technologies, like Palladium, Trusted Platform Module, LaGrande, have always caused lots of controversy in the IT world. Most of the fear, however, has been a result of the lack of understanding of how a particular technology really works.<br /><br />Nevertheless, Trusted Computing is becoming part of our lives, whether we want it or not. These days almost every new laptop comes with an on-board Trusted Platform Module (TPM). Microsoft's Palladium initiative have been renamed so many times in the recent years, that probably even people working at Microsoft are confused now. Nevertheless, some of the Palladium technologies made their way into Vista, and Microsoft BitLocker is, without doubt, the most successful, widely deployed product that is based on the idea of Trusted Computing. (In fact the Bitlocker is the <span style="font-style: italic;">only </span>one thing that I really have been missing since I switched from Vista to Mac some time ago).<br /><br />On the hardware side, besides the famed TPM, we also have had the LaGrande technology, that is often connected with things such as Remote Attestation, Protected Execution and other scary terms…<br /><br /><span style="font-weight: bold;">A word about Trusted Execution Technology</span><br />LaGrande, recently renamed <a href="http://www.intel.com/technology/security/">Trusted Execution Technology (TXT)</a>, is Intel's response to the Trusted Computing trend. TXT is currently part of the <a href="http://www.intel.com/products/vpro/index.htm">vPro™ brand</a>, and for about a year now users can buy a vPro/TXT compatible hardware in regular computer stores (the first one was the <a href="http://www.intel.com/products/desktop/motherboards/dq35jo/dq35jo-overview.htm">DQ35J desktop board</a> with certain Core 2 Duo processors, which I was able to buy at the end of 2007 — remember that TXT requires support from both the CPU and the chipset).<br /><br />TXT is not an alternative to TPM, in fact TXT heavily relies on the TPM to provide basic services like e.g. secure storage of measurements done by the TXT. Also, Palladium, or whatever it is called these days, is not a competition to TXT. Intel TXT can provide building blocks to e.g. Vista Bitlocker, arguably making it more secure then it is now (Current Bitlocker implementation, AFAIK, relies on a so called Static Root of Trust for Measurement, which requires TPM, but not TXT).<br /><br />What kind of measurement would TXT like to store in our TPM? Well, the whole TXT is, in fact, all about making and storing software measurements, or, using a more familiar language, secure hashes of certain software components.<br /><br />The sole purpose of Intel TXT technology is to provide a trusted way for loading and executing system software, e.g. Operating System kernel or Virtualization Machine Monitor. What is extraordinary here is that TXT doesn't make any assumptions about the state of the system before loading the software, thus making it possible for a user to ensure secure load of an OS or VMM, even in a potentially compromised machine.<br /><br />In other words, our system can be all full of boot sector viruses and BIOS rootkits, and god-knows-what-else, and still TXT should allow to load a clean VMM (or OS kernel) in a secure way, immune to all those rootkits present in the system in a moment just before the load process. This TXT-supported load process is called Late Launch, and is implemented via a special new CPU instruction called SENTER.<br /><br />It's a good place to mention that AMD has its own version of the late launch implemented via SKINIT instruction. We haven't looked at the AMD technology thoroughly yet, so I will refrain from commenting on this.<br /><br />The late launch is a pretty amazing thing, when we think about. It promises to effectively provide all the benefits of a computer restart without actually restarting it.<br /><br />It is hard to overemphasize the potential impact that a technology such as TXT could have on computer security. One can immediately see that it could eliminate all the system-level persistent malware — in other words we can easily build systems (VMMs or even standard OSes) that would be immune to attacks that try to compromise system binaries on disk, or attack the system right from the bootloader or BIOS. Combining this with VT-x and VT-d technologies, system developers (for the first time, at least as far as the "PC" platform is considered) have gotten extremely strong tools into their hands that should allow them to create really secure VMMs and OSes…<br /><br />Hopefully by now, my Dear Reader, you should have the feeling what kind of an animal Intel TXT  is and how desperately the world needs it...<br /><br />And now, we are going to move on and show practical attacks on current TXT implementations... :)<br /><br /><span style="font-weight: bold;">Attacking Intel TXT!</span><br />Ok, not in this post today, but rather at the <a href="http://blackhat.com/html/bh-dc-09/bh-dc-09-speakers.html#Wojtczuk">upcoming Black Hat conference</a> in Washington, DC in February. Over the recent months, Rafal and I have been looking at the Intel TXT technology as part of a work done for a customer, to see if this could be used to improve security of a product, from a typical user's perspective. We figured out that it definitely could, but that there are also some issues…<br /><br />And those "issues" gave us a starting point in developing a proof-of-concept (albeit very reliable) exploit that shows how we can bypass trusted boot process implemented by Intel's tboot.<br /><br />Tboot, which is also <a href="http://lxr.xensource.com/lxr/source">part of</a> (scroll down to the end of the page) the Xen hypervisor, can be though of as a reference implementation of TXT-based system loader, that could be used to securely load either the Xen hypervisor or the Linux kernel, when run on a vPro/TXT compatible hardware.<br /><br />[copy-and-paste from <a href="http://invisiblethingslab.com/press/itl-press-2009-01.pdf">the press release</a> follows]<br /><br /><span style="font-style: italic;">Our attack comprises two stages. The first stage requires an implementation flaw in a specific system software. The second stage of the attack is possible thanks to a certain design decision made in the current TXT release.<br /></span><span style="font-style: italic;"></span><span style="font-style: italic;"><br />While evaluating the effectiveness of the Intel® TXT technology, as part of a work done for a customer, we have identified several implementation flaws in the Intel's system software, which allowed to conduct the above mentioned stage-one attack. We have provided Intel with extensive description of the flaws in December 2008, and Intel is currently working on fixing those vulnerabilities.</span><br /><span style="font-style: italic;"><br />We have also been in touch with Intel about the possibility of conducting the second-stage attack since November 2008. In December, after providing Intel with the details about the first-stage attack, Intel promised to release, in the coming weeks, an updated TXT specification for developers that would explain how to design their TXT-based loaders in such a way that they are immune to our attack. Intel claims the current Intel® TXT release does contain the basic building blocks that could be used to prevent our second-stage attack and the release of the additional specification would make it feasible in practice. </span><br /><br />More details in February in DC :)<br /><br /><span style="font-weight: bold;">TXT useless?</span><br />Some people are skeptical about the TXT technology, and not only because of the Irrational Fear of the Trusted Computing (IFTC),  but rather because they point out to the complexity of the whole technology. The complexity is bad, because 1) it leaves more space for potential attacks, and 2) it discourages developers (ISVs) from using the technology in their products (e.g. neither Microsoft, nor VMWare make use of TXT in any of their bare-metal hypervisors, even though TXT is very well suited for this kind of software).<br /><br />It is true that TXT is a very complex technology (the SENTER instruction is probably the masterpiece of the CISC architecture!), but I personally like it. In my opinion this is the first technology available for the PC platform that has the potential to really change something, much more then the NX-feature did a few years ago. Before people will run to the comment box — if you would like to argue about the usefulness/uselessness of Trusted Computing/TXT, please base your opinions on technical facts (read the spec!) and not on your feelings!<br /><br /><span style="font-weight: bold;">Disclaimer (for press)</span><br /><br />Starting January 2009, we (at Invisible Things Lab), decided to issue <a href="http://invisiblethingslab.com/itl/News.html">press releases</a> in addition to this blog. The general rule is: press releases are written for journalists, while the blog is mainly written for other researchers, security enthusiast, etc.<br /><br />The wording of our press releases is carefully chosen to minimize the potential of a possible misinterpretation. The press releases carry less information, but, we think, are better suited for a more general public, that doesn't have background in computer science, programming and security.<br /><br />The blog is written in a much more casual way, without thinking for half an hour on every sentence. The articles on this blog might present some facts as extremely exciting, because e.g. for me, a person deeply involved in a system-level security research, they indeed might be very exciting, which might not be the case for a general audience. I sometimes might also use shortcuts, metaphors, or irony, and other figures of speech, that might not necessarily be obvious for a more general public.<br /><br />If you are a journalist and you think you just found something very sensational on my blog, I would suggest that you double-check with me, before writing about it.<br /><br />Thank you for your cooperation.<br />Joanna Rutkowska,<br />Founder and CEO,<br />Invisible Things Lab.