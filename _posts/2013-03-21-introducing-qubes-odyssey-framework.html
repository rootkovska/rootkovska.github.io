---
layout: post
title: Introducing Qubes Odyssey Framework
date: '2013-03-21T17:47:00.001+01:00'
author: Joanna Rutkowska
tags: 
modified_time: '2014-11-27T13:26:11.508+01:00'
thumbnail: http://3.bp.blogspot.com/-x0nnYdPBMWY/UUsxEwJCxhI/AAAAAAAAAKs/_jpzGFGXT4k/s72-c/Qubes+Odyssey+Diagrams+1.png
blogger_id: tag:blogger.com,1999:blog-24586388.post-7660168967011899954
blogger_orig_url: http://theinvisiblethings.blogspot.com/2013/03/introducing-qubes-odyssey-framework.html
---

<style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  <br /><div style="margin-bottom: 0.12in;">Qubes OS is becoming <a href="/2013/02/28/qubes-2-beta-2-has-been-released.html">more and more</a> advanced, polished, and user friendly OS.</div><div style="margin-bottom: 0.12in;">But Qubes OS, even as advanced as it is now, surely have its limitations. Limitations, that for some users might be difficult to accept, and might discourage them from even trying out the OS. One such limitation is lack of 3D graphics support for applications running in AppVMs. Another one is still-far-from-ideal hardware compatibility – a somehow inherent problem for most (all?) Linux-based systems.</div><div style="margin-bottom: 0.12in;">There is also one more “limitation” of Qubes OS, particularly difficult to overcome... Namely that it is a standalone Operating System, not an <i>application</i> that could be installed inside the user's <i>existing</i><span style="font-style: normal;"> OS. While installing a new application that increases system's security is a no-brianer for most people, switching to a new, exotic OS, is quite a different story...</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Before I discuss how we plan to address those limitations, let's first make a quick digression about what Qubes </span><i>really</i><span style="font-style: normal;"></span><span style="font-style: normal;">is</span><span style="font-style: normal;">, </span><span style="font-style: normal;">as many people often get that wrong...</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">         <style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  </span></div><div style="margin-bottom: 0.12in;"><b><span style="font-style: normal;">What Qubes IS, and what </span><span style="font-style: normal;">Qubes </span><span style="font-style: normal;">IS NOT?</span></b></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;">Qubes surely is not Xen! Qubes only </span><i>uses</i><span style="font-style: normal;">Xen to create isolat</span><span style="font-style: normal;">ed</span><span style="font-style: normal;">containers – security domains </span><span style="font-style: normal;">(</span><span style="font-style: normal;">or zones</span><span style="font-style: normal;">)</span><span style="font-style: normal;">. Qubes also is not a Linux distribution! </span><span style="font-style: normal;">S</span><span style="font-style: normal;">ure, we currently use Fedora 18 as the default template for AppVMs, but </span><span style="font-style: normal;">at the same time </span><span style="font-style: normal;">we also support Windows VMs. </span><span style="font-style: normal;">A</span><span style="font-style: normal;">nd while we also use </span><span style="font-style: normal;">Linux </span><span style="font-style: normal;">as GUI and admin domain, we could really use something different – e.g. Windows as GUI domain.</span></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;">So, what is Qubes then? Qubes (note how I've suddenly dropped the OS suffix) is several things:</span></div><ul><li><div style="margin-bottom: 0.12in;"><span style="font-style: normal;">The  </span><span style="font-style: normal;"><b>way how to configure,  </b></span><span style="font-style: normal;"><b>harden, </b></span><span style="font-style: normal;"><b>and  </b></span><span style="font-style: normal;"><b>use</b></span><span style="font-style: normal;"><b> </b></span><span style="font-style: normal;"><b>the </b></span><span style="font-style: normal;"><b>VMM</b></span><span style="font-style: normal;"> </span><span style="font-style: normal;">(e.g. Xen) to create  isolated security domains, and to minimize </span><span style="font-style: normal;">overall  </span><span style="font-style: normal;">system TC</span><span style="font-style: normal;">B</span><span style="font-style: normal;">.</span></div></li><li><div style="margin-bottom: 0.12in;"><span style="font-style: normal;">Secure</span><span style="font-style: normal;"> </span><span style="font-style: normal;"><b>GUI virtualization</b></span><span style="font-style: normal;"> </span><span style="font-style: normal;">that provides strong gui isolation, while at the same time, provides also seamless  integration of all applications running in different VMs onto one common  desktop. Plus a</span><span style="font-style: normal;"> </span><span style="font-style: normal;">customized  GUI environment, </span><span style="font-style: normal;">including  </span><span style="font-style: normal;">trusted Window Manager that  provide</span><span style="font-style: normal;">s</span><span style="font-style: normal;"> unspoofable decorations for </span><span style="font-style: normal;">the  </span><span style="font-style: normal;">applications'</span><span style="font-style: normal;"> windows.</span></div></li><li><div style="margin-bottom: 0.12in;"><span style="font-style: normal;">Secure  </span><span style="font-style: normal;"><b>inter-domain  </b></span><span style="font-style: normal;"><b>communication and  services </b></span><span style="font-style: normal;"><b>infrastructure</b></span><span style="font-style: normal;"> </span><span style="font-style: normal;">with </span><span style="font-style: normal;">centr</span><span style="font-style: normal;">ally  enforced</span><span style="font-style: normal;"> policy </span><span style="font-style: normal;">engine.  </span><span style="font-style: normal;">Plus some “core”  services built on top of this, such as secure file exchange between  domains.</span></div></li><li><div style="margin-bottom: 0.12in;"><span style="font-style: normal;">Various  </span><span style="font-style: normal;"><b>additional services</b></span><span style="font-style: normal;">,  or “addons”, built on top of Qubes infrastructure, such as  Disposable VMs, Split GPG, TorVM, Trusted PDF converter, etc. These  are just few examples, as basically the sky is the limit here.</span></div></li><li><div style="margin-bottom: 0.12in;"><span style="font-style: normal;"><b>Various  </b></span><span style="font-style: normal;"><b>additional  </b></span><span style="font-style: normal;"><b>customizations</b></span><span style="font-style: normal;"> to </span><span style="font-style: normal;">all the guest OSes that  run in various domains: GUI, Admin, ServiceVMs, and AppVMs.</span></div></li></ul><div style="font-weight: normal; margin-bottom: 0.12in;"><style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  </div><div style="margin-bottom: 0.12in;"><b><span style="font-style: normal;">Introducing </span><span style="font-style: normal;">Qubes HAL: Hypervisor Abstraction Layer</span></b></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;"><span style="font-weight: normal;">Because Qubes is a bunch of technologies and approaches that are mostly independent from the underlying hypervisor, </span></span><span style="font-style: normal;"><span style="font-weight: normal;">as discussed above, </span></span><span style="font-style: normal;"><span style="font-weight: normal;">it's quite natural to consider if we could easily build an abstraction layer </span></span><span style="font-style: normal;"><span style="font-weight: normal;">to </span></span><span style="font-style: normal;"><span style="font-weight: normal;">allow </span></span><span style="font-style: normal;"><span style="font-weight: normal;">the </span></span><span style="font-style: normal;"><span style="font-weight: normal;">use </span></span><span style="font-style: normal;"><span style="font-weight: normal;">of </span></span><span style="font-style: normal;"><span style="font-weight: normal;">different VMMs with Qubes, instead </span></span><span style="font-style: normal;"><span style="font-weight: normal;">of </span></span><span style="font-style: normal;"><span style="font-weight: normal;">j</span></span><span style="font-style: normal;"><span style="font-weight: normal;">ust Xen? </span></span><span style="font-style: normal;"><span style="font-weight: normal;">Turns out this is not as difficult as we originally though</span></span><span style="font-style: normal;"><span style="font-weight: normal;">t, </span></span><span style="font-style: normal;"><span style="font-weight: normal;">a</span></span><span style="font-style: normal;"><span style="font-weight: normal;">nd this is exactly the direction we're taking right now </span></span><span style="font-style: normal;"><span style="font-weight: normal;">with Qubes Odyssey</span></span><span style="font-style: normal;"><span style="font-weight: normal;">! </span></span><span style="font-style: normal;"><span style="font-weight: normal;">To make this possible we're going to use the <a href="http://libvirt.org/">libvirt</a></span></span><a href="http://libvirt.org/"> project</a>.</div><div style="font-style: normal; font-weight: normal; margin-bottom: 0.12in;">So, we might imagine Qubes that is based on Hyper-V or even Virtual Box or VMWare Workstation. In the case of the last two Qubes would no longer be a standalone OS, but rather an “application” that one installs on top of an existing OS, such as Windows. The obvious advantage  we're gaining here is improved hardware compatibility, and ease of deployment.</div><div style="font-style: normal; font-weight: normal; margin-bottom: 0.12in;">And we can go even further and ask: why not use Windows Native Isolation, i.e. mechanisms such as user account separation, process isolation, and ACLs, to implement domain isolation? In other words why not use Windows OS as a kind of “VMM”? This would further dramatically improve  then lightness of the system...</div><div style="font-style: normal; font-weight: normal; margin-bottom: 0.12in;">Of course the price we pay for all this is progressively degraded security, as e.g. Virtual Box cannot be a match to Xen in terms of security, both architecturally and implementation-wise, and not to mention the quality of isolation provided by the Windows kernel, which is even less.</div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-x0nnYdPBMWY/UUsxEwJCxhI/AAAAAAAAAKs/_jpzGFGXT4k/s1600/Qubes+Odyssey+Diagrams+1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-x0nnYdPBMWY/UUsxEwJCxhI/AAAAAAAAAKs/_jpzGFGXT4k/s400/Qubes+Odyssey+Diagrams+1.png" height="300" width="400" /></a></div>&nbsp;          <style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  <br /><div style="font-style: normal; font-weight: normal; margin-bottom: 0.12in;">But on the other hand, it's still better than using “just Windows” which offers essentially only one “zone”, so no domain isolation at all! And if we can get, with minimal effort, most of our Qubes code to work with all those various isolation providers then... why not?</div><div style="font-style: normal; font-weight: normal; margin-bottom: 0.12in;">Being able to seamlessly switch between various hypervisors is only part of the story, of course. The remaining part is the support for different OSes used for various Qubes domains. Currently we use Linux, specifically Fedora 18, in our GUI &amp; Admin domain, but there is no fundamental reason why we couldn't use Windows there instead. We discuss this more in-depth in one of the paragraphs below.</div><div style="font-style: normal; font-weight: normal; margin-bottom: 0.12in;">The diagram below tries to illustrate the trade-offs between hardware compatibility and ease of deployment vs. security when using different isolation backends with Qubes. Some variants might also offer additional benefits, such as “super-lightness” in terms of CPU and memory resources required, as is the case with Windows Native Isolation.</div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-HhDM-aMisq8/UUsxO4o80UI/AAAAAAAAAK0/8sTP4LZIGhg/s1600/Qubes+Odyssey+Diagrams+2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-HhDM-aMisq8/UUsxO4o80UI/AAAAAAAAAK0/8sTP4LZIGhg/s400/Qubes+Odyssey+Diagrams+2.png" height="300" width="400" /></a></div>&nbsp;          <style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  <br /><div style="margin-bottom: 0.12in;"><b><span style="font-style: normal;">Some example configurations</span></b></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Let's now discuss two extreme variants of Qubes – one based on the baremetal Xen hypervisor and the other one based on Windows Native Isolation, so a variant from the </span><span style="font-style: normal;">opposite </span><span style="font-style: normal;">end</span><span style="font-style: normal;">of the spectrum </span><span style="font-style: normal;">(as shown on the illustration above).</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">The diagram below shows </span><span style="font-style: normal;">a </span><span style="font-style: normal;">configuration that uses a </span><span style="font-style: normal;">decent </span><span style="font-style: normal;">baremetal hypervisor, such as Xen, with abilities to securely assign devices to untrusted service </span><span style="font-style: normal;">domains</span><span style="font-style: normal;">(NetVM, UsbVM). So</span><span style="font-style: normal;">, this is very similar to the current Qubes OS.</span></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-rO-XZF5DsFk/UUsxPE-PUXI/AAAAAAAAALA/Xa33gAfmNLQ/s1600/Qubes+Odyssey+Diagrams+3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-rO-XZF5DsFk/UUsxPE-PUXI/AAAAAAAAALA/Xa33gAfmNLQ/s400/Qubes+Odyssey+Diagrams+3.png" height="300" width="400" /></a></div>&nbsp;          <style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  <br /><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Additionally </span><span style="font-style: normal;">we</span><span style="font-style: normal;"></span><span style="font-style: normal;">see</span><span style="font-style: normal;">separate GUI and </span><span style="font-style: normal;">A</span><span style="font-style: normal;">dmin domain</span><span style="font-style: normal;">s:</span><span style="font-style: normal;"></span><span style="font-style: normal;">t</span><span style="font-style: normal;">he GUI domain might perhaps be based on Windows, to provide users with a familiar UI, while the </span><span style="font-style: normal;">A</span><span style="font-style: normal;">dmin domain, </span><span style="font-style: normal;">tasked with domain management and policy enforcement,</span><span style="font-style: normal;">might be based on some minimal Linux </span><span style="font-style: normal;">distribution.</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">In </span><span style="font-style: normal;">the </span><span style="font-style: normal;">current Qubes OS </span><span style="font-style: normal;">there is no distinction between a </span><span style="font-style: normal;">GUI and </span><span style="font-style: normal;">an </span><span style="font-style: normal;">Admin domain </span><span style="font-style: normal;">--</span><span style="font-style: normal;">both </span><span style="font-style: normal;">are </span><span style="font-style: normal;">hosted within one domain called “dom0”. But </span><span style="font-style: normal;">in some cases </span><span style="font-style: normal;">there </span><span style="font-style: normal;">are </span><span style="font-style: normal;">benefits of </span><span style="font-style: normal;">separating the GUI domain from the Admin domain. </span><span style="font-style: normal;">I</span><span style="font-style: normal;">n a corporate scenario, </span><span style="font-style: normal;">for example, the Admin domain </span><span style="font-style: normal;">might </span><span style="font-style: normal;">be accessible only </span><span style="font-style: normal;">to the</span><span style="font-style: normal;"> IT department and not to the end user. This way the user w</span><span style="font-style: normal;">ould</span><span style="font-style: normal;">have no way of </span><span style="font-style: normal;">modifying system-wide policies, and e.g. </span><span style="font-style: normal;">allowing their “work” domain to suddenly talk to the </span><span style="font-style: normal;">wild </span><span style="font-style: normal;">open Internet, </span><span style="font-style: normal;">o</span><span style="font-style: normal;">r to copy </span><span style="font-style: normal;">work</span><span style="font-style: normal;">project files from “work” to “personal” </span><span style="font-style: normal;">domains</span><span style="font-style: normal;">(save for the exotic, </span><span style="font-style: normal;">low-bandwidth</span><span style="font-style: normal;">covert channels, such as through CPU cache).</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">The ability to deprivilege networking and USB stacks by assigning corresponding devices (NICs, and USB controllers) to untrusted, or semi-trused, domains provides great security benefit</span><span style="font-style: normal;">s</span><span style="font-style: normal;">. </span><span style="font-style: normal;">This automatically prevents various attacks </span><span style="font-style: normal;">against </span><span style="font-style: normal;">the </span><span style="font-style: normal;">bugs in </span><span style="font-style: normal;">WiFi stacks </span><span style="font-style: normal;">or </span><a href="/2011/06/01/usb-security-challenges.html"><span style="font-style: normal;">USB </span><span style="font-style: normal;">stacks</span></a><span style="font-style: normal;">.</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">What is not seen on the diagram, but what is typical for baremetal hypervisors is that</span><span style="font-style: normal;"> </span><span style="font-style: normal;">they are usually much smaller than hosted hypervisors, </span><span style="font-style: normal;">implementing less services, and </span><span style="font-style: normal;">delegating most tasks, such as </span><span style="font-style: normal;">the infamous </span><span style="font-style: normal;">I/O emulation</span><span style="font-style: normal;"> </span><span style="font-style: normal;">to </span><span style="font-style: normal;">(</span><span style="font-style: normal;">often</span><span style="font-style: normal;">)</span><span style="font-style: normal;">unprivileged VMs.</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Let's now look at the other extreme example of using Qubes – the diagram below shows </span><span style="font-style: normal;">an architecture of a “Qubized” Windows system that uses either a hosted VMM, such as Virtual Box or VMWare Workstation, or even </span><span style="font-style: normal;">the previously mentioned </span><span style="font-style: normal;">Windows Native Isolation mechanisms, as an isolation provider for domains.</span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-r5BMJgT7h-A/UUsxPRn3RTI/AAAAAAAAALI/WoxyFd59FYI/s1600/Qubes+Odyssey+Diagrams+4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-r5BMJgT7h-A/UUsxPRn3RTI/AAAAAAAAALI/WoxyFd59FYI/s400/Qubes+Odyssey+Diagrams+4.png" height="300" width="400" /></a></div>&nbsp; <br /><style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  <br /><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Of course this architecture lacks many benefits discussed above, such as untrusted domains for networking and USB stacks, small hypervisors, etc. But it still can be used to implement multiple security domains, at </span><span style="font-style: normal;">a</span><span style="font-style: normal;">much lower “price”: better hardware compatibility, easier deployment, and in case of Windows Native Isolation – excellent performance.</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">And it really can be made reasonable, although it might require more effort&nbsp; </span><span style="font-style: normal;">than it might seem at first sight</span><span style="font-style: normal;">. Take Windows Native Isolation – of course just creating different user accounts to represent different domains is not enough, because Windows still doesn't implement true GUI-level isolation. Nor network isolation. So, there is a challenge to do it right, and “right” in this case </span><span style="font-style: normal;">means </span><span style="font-style: normal;">to make the isolation as good as the Windows kernel can isolate processes from different users from each other.</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Sure, a single kernel exploit destroys this all, but it's still better than “one application can (legally) read all my files” policy that 99% of all desktop OSes out there essentially implement </span><span style="font-style: normal;">today.</span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Now, probably the best thing with all this is that once we implement a product based on, say, Qubes for Windows, together with various cool “addons” that will take advantage of the Qubes services infrastructure, and which shall be product-specific, it should then be really easy to upgrade to another VMM, say Hyper-V to boost security. And the users shall not even notice a change in the UI, save for the performance degradation perhaps (well, clearly automatic creation of VMs to handle various users tasks would be more costly on Hyper-V than with Windows Native Isolation, where “VMs” are just... processes).</span></div><div style="margin-bottom: 0.12in;"><b><span style="font-style: normal;">Qubes building blocks – </span><span style="font-style: normal;">implementation details</span></b></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Let's have a look </span><span style="font-style: normal;">now </span><span style="font-style: normal;">at the repository layout for the latest Qubes </span><span style="font-style: normal;">OS</span><span style="font-style: normal;">sources – every name listed below represents a separate code repository that corresponds to a logical module, or a building block of a Qubes system:</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-admin</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-admin-linux</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-agent-linux</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-agent-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-vchan-xen</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">desktop-linux-kde</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">desktop-linux-xfce4</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-agent-linux</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-agent-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-agent-xen-hvm-stubdom</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-common</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-daemon</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">linux-dom0-updates</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">linux-installer-qubes-os</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">linux-kernel</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">linux-template-builder</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">linux-utils</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">linux-yum</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-app-linux-pdf-converter</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-app-linux-split-gpg</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-app-linux-tor</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-app-thunderbird</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-builder</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-manager</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">vmm-xen</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">vmm-xen-windows-pvdrivers</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><br /></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">         <style type="text/css">P { margin-bottom: 0.08in; }A:link {  }</style>  </span></div><div style="font-weight: normal; margin-bottom: 0.12in;"><span style="font-style: normal;">Because </span><span style="font-style: normal;">current </span><span style="font-style: normal;">Qubes R2 still doesn't use HAL layer to support different hypervisors, it can currently </span><span style="font-style: normal;">be </span><span style="font-style: normal;">used </span><span style="font-style: normal;">with </span><span style="font-style: normal;">only one hypervisor, </span><span style="font-style: normal;">namely Xen, whose code is provided by the </span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">vmm-xen</span></span><span style="font-style: normal;">repository (in an ideal world we would be just using vanilla Xen instead of build</span><span style="font-style: normal;">ing</span><span style="font-style: normal;">our own from sources, </span><span style="font-style: normal;">but i</span><span style="font-style: normal;">n reality we like the ability to build it ourselves, slightly modifying some things).</span></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;">O</span><span style="font-style: normal;">nce we </span><span style="font-style: normal;">move towards the Qubes Odyssey architecture </span><span style="font-style: normal;">(essentially by replacing </span><span style="font-style: normal;">the</span><span style="font-style: normal;">hardcoded calls </span><span style="font-style: normal;">to Xen's management stack, </span><span style="font-style: normal;">in the </span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">core-admin</span></span><span style="font-style: normal;"></span><span style="font-style: normal;">module, </span><span style="font-style: normal;">with libvirt calls)</span><span style="font-style: normal;">, we could </span><span style="font-style: normal;">then easily switch Xen for other hypervisors, such as Hyper-V or Virtual Box. In case of Hyper-V we would not have access to the sources of the VMM, of course, so would just be using the stock binaries, although we still might want to maintain </span><span style="font-style: normal;">the</span><span style="font-style: normal;"></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">vmm-hyperv </span></span><span style="font-style: normal;">repository that could contain various hardening scripts and configuration files </span><span style="font-style: normal;">for this </span><span style="font-style: normal;">VMM. </span><span style="font-style: normal;">Or might not. </span><span style="font-style: normal;">Also, chances are high that we would be just able to use the stock libvirt driver</span><span style="font-style: normal;">s</span><span style="font-style: normal;">for Hyper-V </span><span style="font-style: normal;">or Virtual Box,</span><span style="font-style: normal;">so no need for creating </span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">core-</span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">libvirt-</span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">hyper</span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">v</span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;"></span></span>or <span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">core-</span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;"><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">libvirt-</span></span>virtualbox</span></span><span style="font-style: normal;">backend</span><span style="font-style: normal;">s</span><span style="font-style: normal;">.</span></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;">What we will need to provide, is our</span><span style="font-style: normal;">custom inter-</span><span style="font-style: normal;">domain</span><span style="font-style: normal;">communication library </span><span style="font-style: normal;">for each hypervisor supported.</span><span style="font-style: normal;"></span><span style="font-style: normal;">This means we will need to write </span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">core-vchan-hyper</span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">v</span></span><span style="font-style: normal;">or </span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;">core-vchan-virtualbox</span></span><span style="font-style: normal;">. Most (all?) VMMs do provide some kind of API for inter-VM communication (or at least VM-host communication), so the main task of such component is to</span><span style="font-style: normal;"></span><span style="font-style: normal;"> wrap </span><span style="font-style: normal;">the VMM-custom mechanism</span><span style="font-style: normal;"> with Qubes-</span><span style="font-style: normal;">standarized</span><span style="font-style: normal;">API for vchan </span><span style="font-style: normal;">(and this standardization is one thing we're currently working on)</span><span style="font-style: normal;">. </span><span style="font-style: normal;">All in all, i</span><span style="font-style: normal;">n most cases </span><span style="font-style: normal;">this will be a</span><span style="font-style: normal;">simple task.</span></div><div style="margin-bottom: 0.12in;">If we, on the other hand, wanted to support an “exotic” VMM, such as the previously mentioned Windows Native Isolation, which is not really a true VMM, then we will need to write our own libvirt backend to support is:</div><div style="margin-bottom: 0.12in;"><span style="font-family: FreeMono, monospace;">core-libvirt-windows</span></div><div style="margin-bottom: 0.12in;">... as well as the corresponding vchan module (which should be especially trivial to write in this case):</div><div style="margin-bottom: 0.12in;"><span style="font-family: FreeMono, monospace;">core-vchan-windows</span></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;"><span style="font-weight: normal;">Additionally, if we're building a system where the Admin domain is not based on Linux, which would </span></span><span style="font-style: normal;"><span style="font-weight: normal;">likely </span></span><span style="font-style: normal;"><span style="font-weight: normal;">be the case if we used Hyper-V, or Virtual Box for Windows, or, especially, Windows Native Isolation, then we should also provide </span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;"><span style="font-weight: normal;">core-admin-windows</span></span></span><span style="font-style: normal;"><span style="font-weight: normal;">module, that, among other things, </span></span><span style="font-style: normal;"><span style="font-weight: normal;">should </span></span><span style="font-style: normal;"><span style="font-weight: normal;">provide </span></span><span style="font-style: normal;"><span style="font-weight: normal;">Qubes </span></span><span style="font-style: normal;"><span style="font-weight: normal;"><a href="http://wiki.qubes-os.org/trac/wiki/Qrexec"><i>qrexec</i></a>implementation, something that is highly OS-dependent.</span></span></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;"><span style="font-weight: normal;">As can be seen above, we currently only have </span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;"><span style="font-weight: normal;">core-admin-linux</span></span></span><span style="font-style: normal;"><span style="font-weight: normal;">, which is understandable as we currently use Linux in Dom0. But the good news is that we only </span></span><span style="font-style: normal;"><span style="font-weight: normal;">need to </span></span><span style="font-style: normal;"><span style="font-weight: normal;">write </span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;"><span style="font-weight: normal;">core-admin-XXX</span></span></span><span style="font-style: normal;"><span style="font-weight: normal;">once for each OS that is to be supported as an </span></span><span style="font-style: normal;"><span style="font-weight: normal;">A</span></span><span style="font-style: normal;"><span style="font-weight: normal;">dmin domain, a</span></span><span style="font-style: normal;"><span style="font-weight: normal;">s</span></span><span style="font-style: normal;"><span style="font-weight: normal;">this </span></span><span style="font-style: normal;"><span style="font-weight: normal;">code should not be depend on the actual VMM used (thanks to our smart HAL).</span></span></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;"><span style="font-weight: normal;">Similarly, we also need to assure that our </span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;"><span style="font-weight: normal;">gui-daemon</span></span></span><span style="font-style: normal;"><span style="font-weight: normal;">can run on the OS that is </span></span><span style="font-style: normal;"><span style="font-weight: normal;">to be </span></span><span style="font-style: normal;"><span style="font-weight: normal;">used as </span></span><span style="font-style: normal;"><span style="font-weight: normal;">a </span></span><span style="font-style: normal;"><span style="font-weight: normal;">GUI domain (again, in most cases GUI domain would be the same as Admin domain, but not always). Here the situation is generally much easier because “with just a few #ifdefs” our </span></span><span style="font-style: normal;"><span style="font-weight: normal;">current GUI</span></span><span style="font-style: normal;"><span style="font-weight: normal;">daemon should compile and run on most OSes, from Linux/Xorg to Windows and Macs </span></span><span style="font-style: normal;"><span style="font-weight: normal;">(which is the reason we only have one </span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;"><span style="font-weight: normal;">gui-daemon</span></span></span><span style="font-style: normal;"><span style="font-weight: normal;">repository, instead of several </span></span><span style="font-family: FreeMono, monospace;"><span style="font-style: normal;"><span style="font-weight: normal;">gui-daemon-XXX</span></span></span><span style="font-style: normal;"><span style="font-weight: normal;">).</span></span></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;"><span style="font-weight: normal;">Finally we should provide some code that will gather all the components need</span></span><span style="font-style: normal;"><span style="font-weight: normal;">ed</span></span><span style="font-style: normal;"><span style="font-weight: normal;">for our specific product and package this all into either an installable ISO, </span></span><span style="font-style: normal;"><span style="font-weight: normal;">if Qubes is </span></span><span style="font-style: normal;"><span style="font-weight: normal;">to be </span></span><span style="font-style: normal;"><span style="font-weight: normal;">a standalone OS, </span></span><span style="font-style: normal;"><span style="font-weight: normal;">like current Qubes</span></span><span style="font-style: normal;"><span style="font-weight: normal;">,</span></span><span style="font-style: normal;"><span style="font-weight: normal;">or </span></span><span style="font-style: normal;"><span style="font-weight: normal;">into an </span></span><span style="font-style: normal;"><span style="font-weight: normal;">executable, in case Qubes is </span></span><span style="font-style: normal;"><span style="font-weight: normal;">to be </span></span><span style="font-style: normal;"><span style="font-weight: normal;">an “application”. The installer, depending on the product, might do some cool things, such as e.g. take current user system and automatically move it into one of Qubes domains.</span></span></div><div style="margin-bottom: 0.12in;"><span style="font-style: normal;"><span style="font-weight: normal;">To summary, these would be the components needed to build “Qubes for Windows” product:</span></span></div><span style="font-family: FreeMono, monospace;">core-admin</span><br /><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-admin-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-agent-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-vchan-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-libvirt-windows </span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">desktop-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-agent-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-common</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-daemon</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">windows-installer-qubes-for-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-builder</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-manager</span></div><div lang="zxx" style="margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0.12in;"><span lang="zxx">Additionally we will likely need a few </span><span style="font-family: FreeMono, monospace;"><span lang="zxx">qubes-app-*</span></span><span lang="zxx">modules that would implement some "addons", such as perhaps automatic links and documents opening in specific VMs, e.g.:</span></div><div style="margin-bottom: 0.12in;"><span style="font-family: FreeMono, monospace;"><span lang="zxx">qubes-app-windows-mime-handlers</span></span></div><div lang="zxx" style="margin-bottom: 0.12in;"><span style="font-style: normal;"><span style="font-weight: normal;">Here, again, the sky's the limit and this is specifically the area where each vendor can go to great lenghts and build killer apps using our Qubes framework.</span></span></div><div lang="zxx" style="margin-bottom: 0.12in;"><span style="font-style: normal;"><span style="font-weight: normal;">Now</span></span><span style="font-style: normal;"><span style="font-weight: normal;">, if we wanted to create "Qubes for Hyper-V" we would need the following components:</span></span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-admin</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-admin-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-agent-linux</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-agent-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">core-vchan-hyperv</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">desktop-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-agent-linux</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-agent-windows</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-common</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">gui-daemon</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">windows-installer-qubes-hyperv</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-app-XXX</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-builder</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">qubes-manager</span></div><div lang="zxx" style="font-weight: normal; margin-bottom: 0in;"><span style="font-family: FreeMono, monospace;">vmm-hyperv</span></div><div lang="zxx" style="margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0.12in;">Here, as an example, I also left optional <span style="font-family: FreeMono, monospace;">core-agent-linux</span> and <span style="font-family: FreeMono, monospace;">gui-agent-linux</span> components (the same that are to be used with Xen-based Qubes OS) to allow support for also Linux-based VMs – if we can get those “for free”, then why not!  </div><div style="margin-bottom: 0.12in;">It should be striking how many of those components are the same in both of those two cases – essentially the only differences are made by the use of different <span style="font-family: FreeMono, monospace;">vmm-*</span> components and, of course, the different installer</div><div style="margin-bottom: 0.12in;">It should be also clear now how this framework now enables seamless upgrades from one product (say Qubes for Windows) to another (say Qubes for Hyper-V).</div><div style="margin-bottom: 0.12in;"><b>Licensing</b></div><div style="font-weight: normal; margin-bottom: 0.12in;">Our business model assumes working with vendors, as opposed to end users, and licensing to them various code modules needed to create products based on Qubes.</div><div style="font-weight: normal; margin-bottom: 0.12in;">All the code that comprises the base foundation needed for creation of any Qubes variant (so <span style="font-family: FreeMono, monospace;">core-admin</span>, <span style="font-family: FreeMono, monospace;">gui-common</span>, <span style="font-family: FreeMono, monospace;">gui-daemon</span>, <span style="font-family: FreeMono, monospace;">qubes-builder</span>and <span style="font-family: FreeMono, monospace;">qubes-manager</span>) will be kept open source, GPL specifically. Additionally all the code needed for building of Xen-based Qubes OS with Linux-based AppVMs and Linux-based GUI and Admin domains, will continue to be available as open source. This is to ensure Qubes OS R3 that will be based on this framework, can remain fully open source (GPL).</div><div style="font-weight: normal; margin-bottom: 0.12in;">Additionally we plan to double-license this core open source code to vendors who would like to use it in proprietary products and who would not like to be forced, by the GPL license, to share the (modified) sources.</div><div style="font-weight: normal; margin-bottom: 0.12in;">All the other modules, especially those developed to support other VMMs (Hyper-V, Virtual Box, Windows Native Isolation), as well as those to support Windows OS (<span style="font-family: FreeMono, monospace;">gui-agent-windows</span>, <span style="font-family: FreeMono, monospace;">core-agent-windows</span>, <span style="font-family: FreeMono, monospace;">core-admin-windows</span>, etc) will most likely be proprietary and will be available only to vendors who decide to work with us and buy a license.</div><div style="font-weight: normal; margin-bottom: 0.12in;">So, if you want to develop an open source product that uses Qubes framework, then you can freely do that as all the required core components for this will be open sourced. But if you would like to make a proprietary product, then you should buy a license from us. I think this is a pretty fair deal.  </div><div style="font-weight: normal; margin-bottom: 0.12in;"><b>Current status and roadmap</b></div><div style="font-weight: normal; margin-bottom: 0.12in;">We're currently working on two fronts: one is rewriting current Qubes code to support Qubes HAL, while the other one is adding a backend for Windows Native Isolation (which also involves doing things such as GUI isolation right on Windows).</div><div style="font-weight: normal; margin-bottom: 0.12in;">We believe that by implementing two such extreme backends: Xen and Windows Native Isolation we can best show the flexibility of the framework (plus our customer is especially interested in this backend;)</div><div style="font-weight: normal; margin-bottom: 0.12in;">We should be able to publish some code, i.e. the framework together with early Qubes OS R3 that will be based on it, sometime in fall or maybe earlier.</div><div style="font-weight: normal; margin-bottom: 0.12in;">We obviously are determined to further develop Xen-based Qubes OS, because we believe this is the most practically secure OS available today, and we believe such OS should be open source.</div><div style="font-weight: normal; margin-bottom: 0.12in;">Qubes R2 will still be based on the Xen-hardcoded code, because it's close to the final release and we don't want to introduce such drastic changes at this stage. The only thing that Qubes R2 will get in common with Qubes Odyssey is this new source code layout as presented above (but still with hardcoded xl calls and xen-vchan).</div><div style="font-weight: normal; margin-bottom: 0.12in;">So, this is all really exciting and a big thing, let's see if we can change the industry with this :)</div><div style="font-weight: normal; margin-bottom: 0.12in;">Oh, and BTW, some readers might be wondering why the framework was codenamed “Odyssey” -- this is obviously because of the “HAL” which plays a central role here, and which, of course, also brings to mind the famous Kubrick's movie.</div><div style="font-weight: normal; margin-bottom: 0.12in;"></div>