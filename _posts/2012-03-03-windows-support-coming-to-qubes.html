---
layout: post
title: Windows support coming to Qubes!
date: '2012-03-03T12:43:00.000+01:00'
author: Joanna Rutkowska
tags:
- qubes
modified_time: '2012-12-15T12:48:18.912+01:00'
thumbnail: http://3.bp.blogspot.com/-UFnn-9m1pO0/T1IBP9dvJ8I/AAAAAAAAAJs/E41NvH8MQKM/s72-c/qubes-hvm-windows.png
blogger_id: tag:blogger.com,1999:blog-24586388.post-2536319280775711164
blogger_orig_url: http://theinvisiblethings.blogspot.com/2012/03/windows-support-coming-to-qubes.html
---

<style type="text/css"> <!--   @page { margin: 0.79in }   P { margin-bottom: 0.08in }   A:link { so-language: zxx }  </style>Ok, let's start with a screenshot :)<br /><div style="margin-bottom: 0in;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://www.qubes-os.org/files/screenshots/release-2-alpha-1/qubes-hvm-windows.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="225" src="http://3.bp.blogspot.com/-UFnn-9m1pO0/T1IBP9dvJ8I/AAAAAAAAAJs/E41NvH8MQKM/s400/qubes-hvm-windows.png" width="400" /></a></div><div style="margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;">While the “Qubes 1.0” branch is currently in the final development and testing, we have already started working on the Next Big Feature, which is a support for HVM domains (hardware, or VT-x virtualized domains). This allows to run e.g. Windows VMs under Qubes. You might be wondering what so special about this, if Xen has been supporting HVM domains, and specifically Windows VMs for a long time, and Qubes uses Xen hypervisor, so why haven't we had Windows support since day one?</div><div style="margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;">The are a couple of things that we don't like about HVM support in Xen (and also in other VMMs), which include: the need to run device emulator (AKA qemu) in Dom0, the need to use crappy VNC, or a similar protocol to access the VM's framebuffer, or alternatively, the crazy idea (from security point of view, that is) of using a pass-through graphics for a VM, the lack of support for disaggregated architecture where backends, e.g. network backends, run in other domains than Dom0. In fact even the Xen “stubdomain” feature, introduced a few years ago, that was supposed to be a solution allowing to move the qemu out of Dom0, in practice turned out to be quite disappointing, as the qemu in the stub domain still requires an accompanying process of another qemu in Dom0, somehow negating all the security benefits this architecture is supposed to bring... And not to mention the omni present assumption that backends run always in Dom0, hardcoded in a few places in the stubdomain code.</div><div style="margin-bottom: 0in;"><br /></div><div style="margin-bottom: 0in;">So, we didn't like it and that's why Qubes had no Windows support for long time. But this has now changed, as we have just finished the 1<sup>st</sup> stage implementation of HVM support in Qubes, the way we like it, without any security compromises. In our implementation we've completely eliminated all the qemu remains from Dom0 (it's running in a micro stub domain), the graphics virtualization fully integrates with our very slim GUI daemon (we didn't have to modify our GUI daemon at all!), using our Xen-optimized, zero-copy, <a href="http://wiki.qubes-os.org/trac/wiki/GUIdocs">minimalist GUI protocol</a>, and the networking is also fully integrated with the <span id="goog_1494091458"></span><a href="http://theinvisiblethings.blogspot.com/2011/09/playing-with-qubes-networking-for-fun.html">Qubes diaggregated networking architecture</a><a href="http://www.blogger.com/"></a><span id="goog_1494091459"></span>that uses isolated domains for all the networking stacks and drivers. Of course, there are still some rough edges, such as no clipboard support, and the virtualization is currently in a “per-desktop” mode, rather than in a “per-window” mode, which is used for PV domains. But, rest assured, we are working on those things right now...</div><div style="margin-bottom: 0in;"><br /></div>This code is currently not public, and the plan is to release it only after Qubes 1.0 release, either as an upgrade, or as Qubes 2.0. All the dom0 code for HVM support will likely remain GPL, while any Windows-specific code (agent code) will likely be proprietary.